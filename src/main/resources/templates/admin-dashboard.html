<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Dashboard - XYZ Gym</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
          rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background:#121212;
            color:#e0e0e0;
        }
        .header {
            background:#181818;
            padding:15px 30px;
            position:fixed;
            width:100%;
            top:0;
            z-index:1000;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .sidebar {
            position:fixed;
            top:0;
            left:-250px;
            width:250px;
            height:100%;
            background:#1a1a1a;
            padding-top:70px;
            transition:0.3s;
        }
        .sidebar.active { left:0; }
        .sidebar a {
            display:block;
            padding:14px 25px;
            color:#cfcfcf;
            text-decoration:none;
        }
        .sidebar a:hover {
            background:#2a2a2a;
            color:#fff;
        }
        .content {
            padding:90px 30px;
            transition:0.3s;
        }
        .content.shifted { margin-left:250px; }
        .card {
            background:#1f1f1f;
            border:none;
            border-radius:12px;
            margin-bottom:20px;
        }
        table thead {
            background:#222;
        }
        .btn-accent {
            background:linear-gradient(135deg,#ff6f00,#ff3d00);
            border:none;
            color:white;
        }
    </style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
    <div>
        <i class="fas fa-bars me-3" onclick="toggleSidebar()" style="cursor:pointer"></i>
        <b class="text-warning">XYZ Gym Admin</b>
    </div>
    <a href="/logout" class="btn btn-accent btn-sm">
        <i class="fas fa-sign-out-alt"></i> Logout
    </a>
</div>

<!-- ================= SIDEBAR ================= -->
<div id="sidebar" class="sidebar">
    <a href="#members"><i class="fas fa-users"></i> Members</a>
    <a href="#plans"><i class="fas fa-calendar"></i> Plans</a>
    <a href="#assign"><i class="fas fa-dumbbell"></i> Assign Plan</a>
</div>

<!-- ================= CONTENT ================= -->
<div id="content" class="content">

<!-- ================= MEMBERS ================= -->
<section id="members" class="card p-3">
    <h4>Members</h4>

    <table class="table table-dark table-hover">
        <thead>
        <tr>
            <th>ID</th><th>Name</th><th>Email</th>
            <th>Plan</th><th>Expiry</th><th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="m : ${members}">
            <td th:text="${m.id}"></td>
            <td th:text="${m.name}"></td>
            <td th:text="${m.email}"></td>

            <td>
                <span th:if="${m.plan != null}"
                      th:text="${m.plan.planName}"></span>
                <span th:if="${m.plan == null}" class="text-warning">None</span>
            </td>

            <td th:text="${m.expiryDate}"></td>

            <td>
                <button class="btn btn-sm btn-warning"
                        th:onclick="'openEdit('+${m.id}+ ',\''+${m.name}+'\',\''+${m.email}+'\')'">
                    Edit
                </button>

                <button class="btn btn-sm btn-danger"
                        th:onclick="'deleteMember('+${m.id}+')'">
                    Delete
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</section>

<!-- ================= PLANS ================= -->
<section id="plans" class="card p-3">
    <h4>Plans</h4>

    <button class="btn btn-accent mb-2"
            data-bs-toggle="modal"
            data-bs-target="#addPlanModal">
        <i class="fas fa-plus"></i> Add Plan
    </button>

    <table class="table table-dark table-hover">
        <thead>
        <tr><th>ID</th><th>Name</th><th>Months</th><th>Price</th><th>Action</th></tr>
        </thead>
        <tbody>
        <tr th:each="p : ${plans}">
            <td th:text="${p.id}"></td>
            <td th:text="${p.planName}"></td>
            <td th:text="${p.durationMonths}"></td>
            <td th:text="${p.price}"></td>
            <td>
                <button class="btn btn-danger btn-sm"
                        th:onclick="'deletePlan('+${p.id}+')'">
                    Delete
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</section>

<!-- ================= ASSIGN ================= -->
<section id="assign" class="card p-3">
    <h4>Assign Plan</h4>

    <button class="btn btn-accent"
            data-bs-toggle="modal"
            data-bs-target="#assignPlanModal">
        Assign Plan
    </button>
</section>

</div>

<!-- ================= EDIT MEMBER MODAL ================= -->
<div class="modal fade" id="editMemberModal">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <form id="editMemberForm">
                <div class="modal-header">
                    <h5>Edit Member</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="mid">
                    <input class="form-control mb-2" name="name" id="mname">
                    <input class="form-control" name="email" id="memail">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-accent">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= ADD PLAN MODAL ================= -->
<div class="modal fade" id="addPlanModal">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <form id="addPlanForm">
                <div class="modal-header">
                    <h5>Add Plan</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input class="form-control mb-2" name="planName" placeholder="Plan Name">
                    <input class="form-control mb-2" name="durationMonths" type="number" placeholder="Months">
                    <input class="form-control" name="price" type="number" placeholder="Price">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-accent">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= ASSIGN PLAN MODAL ================= -->
<div class="modal fade" id="assignPlanModal">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <form id="assignPlanForm">
                <div class="modal-header">
                    <h5>Assign Plan</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <select class="form-select mb-2" name="memberId">
                        <option th:each="m : ${members}"
                                th:value="${m.id}"
                                th:text="${m.name}"></option>
                    </select>

                    <select class="form-select" name="planId">
                        <option th:each="p : ${plans}"
                                th:value="${p.id}"
                                th:text="${p.planName}"></option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-accent">Assign</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function toggleSidebar(){
    sidebar.classList.toggle('active');
    content.classList.toggle('shifted');
}

function openEdit(id,n,e){
    mid.value=id; mname.value=n; memail.value=e;
    new bootstrap.Modal(editMemberModal).show();
}

editMemberForm.onsubmit = e => {
    e.preventDefault();
    fetch('/admin/editMember',{method:'POST',body:new URLSearchParams(new FormData(e.target))})
        .then(()=>location.reload());
};

addPlanForm.onsubmit = e => {
    e.preventDefault();
    fetch('/admin/addPlan',{method:'POST',body:new URLSearchParams(new FormData(e.target))})
        .then(()=>location.reload());
};

assignPlanForm.onsubmit = e => {
    e.preventDefault();
    fetch('/admin/assignPlan',{method:'POST',body:new URLSearchParams(new FormData(e.target))})
        .then(()=>location.reload());
};

function deleteMember(id){
    if(confirm("Delete member?"))
        fetch('/admin/deleteMember',{method:'POST',body:'id='+id,
        headers:{'Content-Type':'application/x-www-form-urlencoded'}})
            .then(()=>location.reload());
}

function deletePlan(id){
    if(confirm("Delete plan?"))
        fetch('/admin/deletePlan',{method:'POST',body:'id='+id,
        headers:{'Content-Type':'application/x-www-form-urlencoded'}})
            .then(()=>location.reload());
}
</script>

</body>
</html>
