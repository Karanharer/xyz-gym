<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Payment - XYZ Gym</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body style="background:#121212; color:#e0e0e0; font-family:'Poppins',sans-serif; padding:40px;">

<div class="container" style="max-width:600px;">
    <h3>Pay for Plan: <span th:text="${plan.planName}"></span></h3>
    <p>Duration: <span th:text="${plan.durationMonths}"></span> months</p>
    <p>Amount: ₹ <span th:text="${plan.price}"></span></p>

    <button id="rzp-button" class="btn btn-warning mt-3 w-100">
        Pay Now
    </button>
</div>

<script th:inline="javascript">
/*<![CDATA[*/

    const priceInRupees = /*[[${plan.price}]]*/ 0;
    const amountInPaise = priceInRupees * 100;

    const options = {
        key: "[[${razorpayKeyId}]]",   // ✅ MUST be string
        amount: amountInPaise,
        currency: "INR",
        name: "XYZ Gym",
        description: "[[${plan.planName}]] Plan",

        handler: function (response) {
            fetch("/member/paymentSuccess", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body:
                    "razorpayPaymentId=" + response.razorpay_payment_id +
                    "&planId=" + /*[[${plan.id}]]*/ 0 +
                    "&amount=" + priceInRupees
            }).then(() => {
                window.location.href = "/member/dashboard";
            });
        },

        theme: {
            color: "#ff6f00"
        }
    };

    const rzp1 = new Razorpay(options);

    document.getElementById("rzp-button").addEventListener("click", function (e) {
        rzp1.open();
        e.preventDefault();
    });

/*]]>*/
</script>

</body>
</html>
